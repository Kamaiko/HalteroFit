# Dependabot Configuration - Halterofit (Optimized)
# Version: 2.0 (2025-11-06)
# Philosophy: Surgical automation with Expo SDK awareness

version: 2
updates:
  # NPM Dependencies
  - package-ecosystem: "npm"
    directory: "/"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "06:00"  # 11:00 UTC - Off-peak hours for better GitHub API performance
      timezone: "America/New_York"

    # Increased limit now that overrides resolve peer deps
    open-pull-requests-limit: 8

    # Auto-rebase PRs when they fall behind base branch
    # Required for auto-merge to work (GitHub won't merge BEHIND PRs)
    rebase-strategy: "auto"

    # Assign PRs to maintainer for review
    assignees:
      - "Kamaiko"

    # Group similar updates to reduce PR noise
    groups:
      # Dev dependencies - Auto-merged by CI workflow
      # TypeScript, ESLint, Jest, Prettier, etc.
      dev-dependencies:
        patterns:
          - "@types/*"
          - "@typescript-eslint/*"
          - "eslint*"
          - "prettier"
          - "lint-staged"
          - "husky"
          - "@commitlint/*"
          - "jest*"
          - "@testing-library/*"
        update-types:
          - "minor"
          - "patch"

      # Runtime patch updates - Auto-merged by CI workflow
      # Bug fixes only (0.0.X), low risk
      runtime-patches:
        patterns:
          - "*"
        exclude-patterns:
          - "@types/*"
          - "@typescript-eslint/*"
          - "eslint*"
          - "prettier"
          - "lint-staged"
          - "husky"
          - "@commitlint/*"
          - "jest*"
          - "@testing-library/*"
          # Exclude critical packages from patches group
          - "expo"
          - "react"
          - "react-native"
          - "@nozbe/watermelondb"
          - "@supabase/supabase-js"
        update-types:
          - "patch"

      # NEW: React ecosystem (minor updates only)
      # React is stable enough to auto-group minor updates
      react-ecosystem:
        patterns:
          - "react"
          - "@types/react"
          - "react-test-renderer"
        update-types:
          - "minor"
          - "patch"

    # Critical packages always get separate PRs (manual review required)
    # Expo, React Native, WatermelonDB, Supabase
    # These need careful testing before merge

    # Ignore specific incompatible versions
    ignore:
      # Tailwind CSS v4 - Incompatible with NativeWind v4
      # Requires NativeWind v5 (preview). Will upgrade when NativeWind v5 is stable.
      # See: PR #19 analysis (closed 2025-10-30)
      - dependency-name: "tailwindcss"
        versions: [">=4.0.0"]

      # React Native - LOCKED to Expo SDK version
      # NEVER upgrade independently of Expo SDK
      # Current: 0.81.5 (Expo SDK 54)
      # Next: Wait for Expo SDK 55 (Q1-Q2 2026)
      - dependency-name: "react-native"
        update-types: ["version-update:semver-minor", "version-update:semver-major"]

      # React Native ecosystem packages - Follow Expo SDK compatibility
      - dependency-name: "react-native-reanimated"
        update-types: ["version-update:semver-major"]
      - dependency-name: "react-native-screens"
        update-types: ["version-update:semver-major"]
      - dependency-name: "react-native-safe-area-context"
        update-types: ["version-update:semver-major"]

      # Expo SDK - Only patch updates auto-allowed
      # Minor/major upgrades require migration guide review
      - dependency-name: "expo"
        update-types: ["version-update:semver-minor", "version-update:semver-major"]

    # Custom labels for better organization
    labels:
      - "dependencies"
      - "javascript"

    commit-message:
      prefix: "chore"
      include: "scope"

  # GitHub Actions - Auto-merged after CI passes
  # SHA pinning ensures security
  - package-ecosystem: "github-actions"
    directory: "/"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "06:00"  # 11:00 UTC - Off-peak hours for better GitHub API performance
      timezone: "America/New_York"

    open-pull-requests-limit: 3

    # Auto-rebase PRs when they fall behind base branch
    rebase-strategy: "auto"

    labels:
      - "github-actions"
      - "ci"

    commit-message:
      prefix: "chore(ci)"
