# Dependabot Configuration - Halterofit
# =============================================================================
#
# Strategy: THREE-TIER APPROACH
#
# 1. EXPO-LOCKED: Native/SDK-coupled packages
#    → Block ALL updates
#    → Upgrade ONLY via `npx expo install`
#
# 2. UI UTILITIES: Stable CSS/styling packages (clsx, tailwind-merge, etc.)
#    → Auto-merge minor + patch
#
# 3. STATE/DATA LIBS: App behavior packages (zustand, zod, supabase)
#    → Auto-merge patch ONLY (minors require manual review)
#
# =============================================================================

version: 2
updates:
  # ===========================================================================
  # NPM Dependencies
  # ===========================================================================
  - package-ecosystem: "npm"
    directory: "/"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "06:00"
      timezone: "America/New_York"

    open-pull-requests-limit: 5
    rebase-strategy: "auto"

    # =========================================================================
    # GROUPS - Auto-merged safe packages
    # =========================================================================
    groups:
      # Dev tooling - TypeScript, Linting, Testing
      dev-dependencies:
        patterns:
          - "@typescript-eslint/*"
          - "@types/*"
          - "@testing-library/*"
          - "@commitlint/*"
          - "eslint*"
          - "jest"
          - "prettier"
          - "lint-staged"
          - "husky"
          - "typescript"
          - "ts-node"
          - "msw"
        update-types:
          - "minor"
          - "patch"

      # UI utilities - Stable APIs, safe for minor updates
      ui-utilities:
        patterns:
          - "clsx"
          - "class-variance-authority"
          - "tailwind-merge"
          - "tailwindcss-animate"
          - "@rn-primitives/*"
        update-types:
          - "minor"
          - "patch"

      # State/data libs - Patch only (minors can change app behavior)
      state-data-libs:
        patterns:
          - "zustand"
          - "zod"
          - "@supabase/supabase-js"
        update-types:
          - "patch"

    # =========================================================================
    # EXPO-LOCKED: Block ALL updates for native/SDK-coupled packages
    # =========================================================================
    # These packages are upgraded ONLY during Expo SDK upgrades via:
    #   npx expo install <package-name>
    #
    # Rationale: Even patch updates can cause native module mismatches
    # (C++ vs JS version conflicts) requiring full EAS rebuilds.
    # =========================================================================
    ignore:
      # -----------------------------------------------------------------------
      # EXPO SDK CORE
      # -----------------------------------------------------------------------
      - dependency-name: "expo"
      - dependency-name: "expo-*"
      - dependency-name: "babel-preset-expo"
      - dependency-name: "jest-expo"

      # -----------------------------------------------------------------------
      # REACT ECOSYSTEM
      # -----------------------------------------------------------------------
      - dependency-name: "react"
      - dependency-name: "react-native"
      - dependency-name: "react-test-renderer"

      # -----------------------------------------------------------------------
      # REACT NATIVE PACKAGES (all have native code)
      # -----------------------------------------------------------------------
      - dependency-name: "react-native-*"

      # -----------------------------------------------------------------------
      # THIRD-PARTY NATIVE LIBRARIES
      # -----------------------------------------------------------------------
      - dependency-name: "@sentry/react-native"
      - dependency-name: "@shopify/flash-list"
      - dependency-name: "@shopify/react-native-skia"
      - dependency-name: "@nozbe/watermelondb"
      - dependency-name: "victory-native"
      - dependency-name: "nativewind"

      # -----------------------------------------------------------------------
      # TAILWINDCSS - Locked to v3 (NativeWind v4 requires TailwindCSS v3)
      # -----------------------------------------------------------------------
      - dependency-name: "tailwindcss"
        versions: [">=4.0.0"]

    labels:
      - "dependencies"

    commit-message:
      prefix: "chore"
      include: "scope"

  # ===========================================================================
  # GitHub Actions
  # ===========================================================================
  - package-ecosystem: "github-actions"
    directory: "/"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "06:00"
      timezone: "America/New_York"

    open-pull-requests-limit: 3
    rebase-strategy: "auto"

    labels:
      - "github-actions"
      - "ci"

    commit-message:
      prefix: "chore(ci)"
